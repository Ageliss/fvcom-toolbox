<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of wrf2fvcom</title>
  <meta name="keywords" content="wrf2fvcom">
  <meta name="description" content="Dumps all WRF output to FVCOM compatible netCDF.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">fvcom_prepro</a> &gt; wrf2fvcom.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for fvcom_prepro&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>wrf2fvcom
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Dumps all WRF output to FVCOM compatible netCDF.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function wrf2fvcom(wrffile, fvfile) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Dumps all WRF output to FVCOM compatible netCDF.

 wrf2fvcom(ncfile, wrffile)

 DESCRIPTION:
   Take WRF netCDF output (e.g. from version 3.7.1 of WRF) and convert to
   the format FVCOM requires for netCDF forcing files.

 INPUT:
   wrffile - path to the WRF netCDF file.
   fvfile - path to the FVCOM forcing file to create.

 OUTPUT:
   FVCOM forcing netCDF file (fvfile).

 EXAMPLE USAGE:
   wrf2fvcom('wrfout_d01_2000-01-01_00:00:00', 'casename_v01_wnd.nc')

 NOTES:
   This currently only supports regularly gridded output (i.e. WRF native
   grid). Support for writing out unstructured data may come in the
   future.

 Author(s):
   Dmitry Aleynik (Scottish Association for Marine Science)
   Pierre Cazenave (Plymouth Marine Laboratory)

 Revision history:
   2015-10-23 - First version developed with reference to Dmitry Aleynik's
   dump_meteo_fvgrid.m function.

==========================================================================</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function wrf2fvcom(wrffile, fvfile)</a>
0002 <span class="comment">% Dumps all WRF output to FVCOM compatible netCDF.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% wrf2fvcom(ncfile, wrffile)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% DESCRIPTION:</span>
0007 <span class="comment">%   Take WRF netCDF output (e.g. from version 3.7.1 of WRF) and convert to</span>
0008 <span class="comment">%   the format FVCOM requires for netCDF forcing files.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% INPUT:</span>
0011 <span class="comment">%   wrffile - path to the WRF netCDF file.</span>
0012 <span class="comment">%   fvfile - path to the FVCOM forcing file to create.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% OUTPUT:</span>
0015 <span class="comment">%   FVCOM forcing netCDF file (fvfile).</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% EXAMPLE USAGE:</span>
0018 <span class="comment">%   wrf2fvcom('wrfout_d01_2000-01-01_00:00:00', 'casename_v01_wnd.nc')</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% NOTES:</span>
0021 <span class="comment">%   This currently only supports regularly gridded output (i.e. WRF native</span>
0022 <span class="comment">%   grid). Support for writing out unstructured data may come in the</span>
0023 <span class="comment">%   future.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Author(s):</span>
0026 <span class="comment">%   Dmitry Aleynik (Scottish Association for Marine Science)</span>
0027 <span class="comment">%   Pierre Cazenave (Plymouth Marine Laboratory)</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% Revision history:</span>
0030 <span class="comment">%   2015-10-23 - First version developed with reference to Dmitry Aleynik's</span>
0031 <span class="comment">%   dump_meteo_fvgrid.m function.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%==========================================================================</span>
0034 
0035 <span class="keyword">global</span> ftbverbose;
0036 subname = <span class="string">'wrf2fvcom'</span>;
0037 <span class="keyword">if</span> ftbverbose
0038     fprintf(<span class="string">'\nbegin : %s \n'</span>, subname)
0039     fprintf(<span class="string">'Read WRF output from %s... '</span>, wrffile)
0040 <span class="keyword">end</span>
0041 
0042 <span class="comment">% Read the WRF output and build a struct with the relevant fields in it.</span>
0043 wrf_fields = {<span class="string">'Shortwave'</span> ,<span class="string">'Net_Heat'</span>, <span class="keyword">...</span>
0044     <span class="string">'U10'</span>, <span class="string">'V10'</span>, <span class="keyword">...</span>
0045     <span class="string">'Precipitation'</span>, <span class="string">'Evaporation'</span>, <span class="string">'SLP'</span>, <span class="keyword">...</span>
0046     <span class="string">'XLAT'</span>, <span class="string">'XLONG'</span>, <span class="string">'Times'</span>};
0047 
0048 <span class="keyword">for</span> ff = 1:length(wrf_fields)
0049     wrf.(wrf_fields{ff}) = ncread(wrffile, wrf_fields{ff});
0050 <span class="keyword">end</span>
0051 
0052 <span class="comment">% Get the required dimensions.</span>
0053 finfo = ncinfo(wrffile);
0054 dimnames = {finfo.Dimensions.Name};
0055 <span class="keyword">for</span> dd = 1:length(dimnames);
0056     <span class="keyword">switch</span> dimnames{dd}
0057         <span class="keyword">case</span> <span class="string">'west_east'</span>
0058             wrf.west_east = finfo.Dimensions(dd).Length;
0059         <span class="keyword">case</span> <span class="string">'south_north'</span>
0060             wrf.south_north = finfo.Dimensions(dd).Length;
0061         <span class="keyword">case</span> <span class="string">'DateStrLen'</span>
0062             wrf.DateStrLen = finfo.Dimensions(dd).Length;
0063     <span class="keyword">end</span>
0064 <span class="keyword">end</span>
0065 
0066 <span class="comment">% Sort out times.</span>
0067 wrf.ntimes = length(wrf.Times(1, :));
0068 wrf.mtime = datenum(wrf.Times');
0069 
0070 <span class="keyword">if</span> ftbverbose
0071     fprintf(<span class="string">'done.\n'</span>)
0072 <span class="keyword">end</span>
0073 
0074 grid_name = <span class="string">'wrf_grid'</span>;
0075 grid_source = <span class="string">'wrf grid (structured) surface forcing'</span>;
0076 CoordVar = <span class="string">'lat lon'</span>;
0077 
0078 <span class="comment">% -------------------------------------------------------------------------</span>
0079 <span class="comment">% Define the netCDF parameters</span>
0080 <span class="comment">%--------------------------------------------------------------------------</span>
0081 
0082 <span class="keyword">if</span> ftbverbose
0083     fprintf(<span class="string">'Export WRF to FVCOM input file %s... '</span>, fvfile)
0084 <span class="keyword">end</span>
0085 
0086 <span class="comment">% Define global attributes.</span>
0087 nc.type = <span class="string">'FVCOM METEO FORCING FILE'</span>;
0088 nc.title = <span class="string">'WRF model forcing'</span>;
0089 nc.history = sprintf(<span class="string">'File created with %s from the MATLAB fvcom-toolbox'</span>, subname);
0090 nc.source =  grid_source;
0091 nc.START_DATE = datestr(wrf.mtime(1, 1), 31);
0092 nc.END_DATE = datestr(wrf.mtime(<span class="keyword">end</span>, 1), 31);
0093 nc.file = fvfile;
0094 nc.Conventions = <span class="string">'CF-1.0'</span>;
0095 
0096 <span class="comment">% Populate the global attributes.</span>
0097 ncid = netcdf.create(fvfile, <span class="string">'clobber'</span>);
0098 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'type'</span>, nc.type);
0099 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'title'</span>, nc.title);
0100 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'history'</span>, nc.history);
0101 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'source'</span>, nc.source);
0102 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'START_DATE'</span>, nc.START_DATE);
0103 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'END_DATE'</span>, nc.END_DATE);
0104 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'file'</span>, nc.file);
0105 netcdf.putAtt(ncid, netcdf.getConstant(<span class="string">'NC_GLOBAL'</span>), <span class="string">'Conventions'</span>,nc.Conventions);
0106 
0107 sn_idim = netcdf.defDim(ncid, <span class="string">'south_north'</span>, wrf.south_north);
0108 we_idim = netcdf.defDim(ncid, <span class="string">'west_east'</span>, wrf.west_east);
0109 DateStrLen_idim = netcdf.defDim(ncid, <span class="string">'DateStrLen'</span>, wrf.DateStrLen);
0110 time_idim = netcdf.defDim(ncid, <span class="string">'time'</span>, 0);
0111 
0112 <span class="comment">% Variables</span>
0113 varid_Times = netcdf.defVar(ncid, <span class="string">'Times'</span>, <span class="string">'NC_CHAR'</span>, [DateStrLen_idim, time_idim]);
0114 netcdf.putAtt(ncid, varid_Times, <span class="string">'description'</span>, <span class="string">'UTC'</span>);
0115 
0116 varid_XLAT = netcdf.defVar(ncid, <span class="string">'XLAT'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim]);
0117 varid_XLONG = netcdf.defVar(ncid, <span class="string">'XLONG'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim]);
0118 varid_Shortwave = netcdf.defVar(ncid, <span class="string">'Shortwave'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim, time_idim]);
0119 varid_Net_Heat = netcdf.defVar(ncid, <span class="string">'Net_Heat'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim, time_idim]);
0120 varid_U10 = netcdf.defVar(ncid, <span class="string">'U10'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim, time_idim]);
0121 varid_V10 = netcdf.defVar(ncid, <span class="string">'V10'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim, time_idim]);
0122 varid_Precipitation = netcdf.defVar(ncid, <span class="string">'Precipitation'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim, time_idim]);
0123 varid_Evaporation = netcdf.defVar(ncid, <span class="string">'Evaporation'</span>, <span class="string">'NC_FLOAT'</span>, [we_idim, sn_idim, time_idim]);
0124 varid_SLP = netcdf.defVar(ncid, <span class="string">'air_pressure'</span>, <span class="string">'NC_FLOAT'</span>,[we_idim, sn_idim, time_idim]);
0125 
0126 netcdf.putAtt(ncid, varid_XLAT, <span class="string">'long_name'</span>, <span class="string">'latitude'</span>);
0127 netcdf.putAtt(ncid, varid_XLAT, <span class="string">'description'</span>, <span class="string">'LATITUDE, SOUTH IS NEGATIVE'</span>);
0128 netcdf.putAtt(ncid, varid_XLAT, <span class="string">'units'</span>, <span class="string">'degrees_north'</span>);
0129 netcdf.putAtt(ncid, varid_XLAT, <span class="string">'type'</span>, <span class="string">'data'</span>);
0130 netcdf.putAtt(ncid, varid_XLONG, <span class="string">'long_name'</span>, <span class="string">'longitude'</span>);
0131 netcdf.putAtt(ncid, varid_XLONG, <span class="string">'description'</span>, <span class="string">'LONGITUDE, WEST IS NEGATIVE'</span>);
0132 netcdf.putAtt(ncid, varid_XLONG, <span class="string">'units'</span>, <span class="string">'degrees_east'</span>);
0133 netcdf.putAtt(ncid, varid_XLONG, <span class="string">'type'</span>, <span class="string">'data'</span>);
0134 
0135 netcdf.putAtt(ncid, varid_Shortwave, <span class="string">'long_name'</span>, <span class="string">'Shortwave, upward is negative'</span>);
0136 netcdf.putAtt(ncid, varid_Shortwave, <span class="string">'units'</span>, <span class="string">'W m-2'</span>);
0137 netcdf.putAtt(ncid, varid_Shortwave, <span class="string">'grid'</span>, grid_name);
0138 netcdf.putAtt(ncid, varid_Shortwave, <span class="string">'coordinates'</span>, CoordVar);
0139 netcdf.putAtt(ncid, varid_Shortwave, <span class="string">'type'</span>, <span class="string">'data'</span>);
0140 
0141 netcdf.putAtt(ncid, varid_Net_Heat, <span class="string">'long_name'</span>, <span class="string">'Sum of shortwave, longwave, sensible and latent heat fluxes, ocean lose heat is negative'</span>);
0142 netcdf.putAtt(ncid, varid_Net_Heat, <span class="string">'units'</span>, <span class="string">'W m-2'</span>);
0143 netcdf.putAtt(ncid, varid_Net_Heat, <span class="string">'grid'</span>, grid_name);
0144 netcdf.putAtt(ncid, varid_Net_Heat, <span class="string">'coordinates'</span>, CoordVar);
0145 netcdf.putAtt(ncid, varid_Net_Heat, <span class="string">'type'</span>, <span class="string">'data'</span>);
0146 
0147 netcdf.putAtt(ncid, varid_U10, <span class="string">'long_name'</span>, <span class="string">'Eastward Wind Velocity'</span>);
0148 netcdf.putAtt(ncid, varid_U10, <span class="string">'description'</span>, <span class="string">'U at 10 M'</span>);
0149 netcdf.putAtt(ncid, varid_U10, <span class="string">'units'</span>, <span class="string">'m s-1'</span>  );
0150 netcdf.putAtt(ncid, varid_U10, <span class="string">'grid'</span>, grid_name);
0151 netcdf.putAtt(ncid, varid_U10, <span class="string">'type'</span>, <span class="string">'data'</span>);
0152 
0153 netcdf.putAtt(ncid, varid_V10, <span class="string">'long_name'</span>, <span class="string">'Northward Wind Velocity'</span>);
0154 netcdf.putAtt(ncid, varid_V10, <span class="string">'description'</span>, <span class="string">'V at 10 M'</span>);
0155 netcdf.putAtt(ncid, varid_V10, <span class="string">'units'</span>, <span class="string">'m s-1'</span>  );
0156 netcdf.putAtt(ncid, varid_V10, <span class="string">'grid'</span>, grid_name);
0157 netcdf.putAtt(ncid, varid_V10, <span class="string">'type'</span>, <span class="string">'data'</span>);
0158 
0159 netcdf.putAtt(ncid, varid_Precipitation, <span class="string">'long_name'</span>, <span class="string">'Precipitation'</span>);
0160 netcdf.putAtt(ncid, varid_Precipitation, <span class="string">'description'</span>, <span class="string">'Precipitation, ocean lose water is negative'</span>);
0161 netcdf.putAtt(ncid, varid_Precipitation, <span class="string">'units'</span>, <span class="string">'m s-1'</span>  );
0162 netcdf.putAtt(ncid, varid_Precipitation, <span class="string">'grid'</span>, grid_name);
0163 netcdf.putAtt(ncid, varid_Precipitation, <span class="string">'coordinates'</span>, CoordVar);
0164 netcdf.putAtt(ncid, varid_Precipitation, <span class="string">'type'</span>, <span class="string">'data'</span>);
0165 
0166 netcdf.putAtt(ncid, varid_Evaporation, <span class="string">'long_name'</span>, <span class="string">'Evaporation'</span>);
0167 netcdf.putAtt(ncid, varid_Evaporation, <span class="string">'description'</span>, <span class="string">'Evaporation, ocean lose water is negative'</span>);
0168 netcdf.putAtt(ncid, varid_Evaporation, <span class="string">'units'</span>, <span class="string">'m s-1'</span>  );
0169 netcdf.putAtt(ncid, varid_Evaporation, <span class="string">'grid'</span>, grid_name);
0170 netcdf.putAtt(ncid, varid_Evaporation, <span class="string">'coordinates'</span>, CoordVar);
0171 netcdf.putAtt(ncid, varid_Evaporation, <span class="string">'type'</span>, <span class="string">'data'</span>);
0172 
0173 netcdf.putAtt(ncid, varid_SLP, <span class="string">'long_name'</span>, <span class="string">'Air Pressure'</span>);
0174 netcdf.putAtt(ncid, varid_SLP, <span class="string">'description'</span>, <span class="string">'Sea surface airpressure'</span>);
0175 netcdf.putAtt(ncid, varid_SLP, <span class="string">'units'</span>, <span class="string">'Pa'</span>  );
0176 netcdf.putAtt(ncid, varid_SLP, <span class="string">'grid'</span>, grid_name);
0177 netcdf.putAtt(ncid, varid_SLP, <span class="string">'coordinates'</span>, CoordVar);
0178 netcdf.putAtt(ncid, varid_SLP, <span class="string">'type'</span>, <span class="string">'data'</span>);
0179 
0180 netcdf.endDef(ncid);
0181 
0182 <span class="comment">% -------------------------------------------------------------------------</span>
0183 <span class="comment">% Dump the data</span>
0184 <span class="comment">% -------------------------------------------------------------------------</span>
0185 
0186 <span class="keyword">for</span> i = 1:wrf.ntimes
0187     cc = datestr(wrf.mtime(i), 31);
0188     netcdf.putVar(ncid, varid_Times, [0, i-1], [19, 1], cc);
0189 <span class="keyword">end</span>
0190 
0191 netcdf.putVar(ncid, varid_XLONG, [0, 0], size(wrf.XLONG), wrf.XLONG)
0192 netcdf.putVar(ncid, varid_XLAT, [0, 0], size(wrf.XLAT), wrf.XLAT)
0193 
0194 netcdf.putVar(ncid, varid_Shortwave, [0, 0, 0], size(wrf.Shortwave), wrf.Shortwave); <span class="comment">% shortwave W/m^2</span>
0195 netcdf.putVar(ncid, varid_Net_Heat, [0, 0, 0], size(wrf.Net_Heat), wrf.Net_Heat); <span class="comment">% net W/m^2</span>
0196 netcdf.putVar(ncid, varid_U10, [0, 0, 0], size(wrf.U10), wrf.U10); <span class="comment">% m/s</span>
0197 netcdf.putVar(ncid, varid_V10, [0, 0, 0], size(wrf.V10), wrf.V10); <span class="comment">% m/s</span>
0198 netcdf.putVar(ncid, varid_Precipitation, [0, 0, 0], size(wrf.Precipitation), wrf.Precipitation); <span class="comment">% m/s</span>
0199 netcdf.putVar(ncid, varid_Evaporation, [0, 0, 0], size(wrf.Evaporation), wrf.Evaporation); <span class="comment">% m/s</span>
0200 netcdf.putVar(ncid, varid_SLP, [0, 0, 0], size(wrf.SLP), wrf.SLP * 100); <span class="comment">% mbar -&gt; Pa</span>
0201 
0202 netcdf.close(ncid);
0203 
0204 <span class="keyword">if</span> ftbverbose
0205     fprintf(<span class="string">'done.\n'</span>)
0206 <span class="keyword">end</span>
0207 
0208 <span class="keyword">if</span> ftbverbose
0209     fprintf(<span class="string">'end   : %s \n'</span>, subname)
0210 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 07-Dec-2015 09:59:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>